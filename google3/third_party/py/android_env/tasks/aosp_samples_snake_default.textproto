# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "aosp_samples_snake_default"
name: "AOSP Samples Snake - Default"
description: "This is an implementation of the classic Game \"Snake\", in which you control a serpent roaming around the garden looking for apples. Be careful, though, because when you catch one, not only will you become longer, but you'll move faster. Running into yourself or the walls will end the game."
package_name: "com.example.android.snake"
full_activity_name: "com.example.android.snake/com.example.android.snake.Snake"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: BUILT_INTERNALLY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/aosp_samples_snake"
          label: "0.3"
          path: "2020.07.27-aosp-samples-snake-debug.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "com.example.android.snake"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  { adb_call: { force_stop: { package_name: "com.example.android.snake" } } },
  { adb_call: { clear_cache: { package_name: "com.example.android.snake" } } },
  {
    adb_call: {
      start_activity: {
        full_activity: "com.example.android.snake/com.example.android.snake.Snake"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            "--es", '"RL_TASK_GAME_CONFIG"', '"{}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "com.example.android.snake/com.example.android.snake.Snake"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
      num_retries: 10
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "com.example.android.snake/com.example.android.snake.Snake"
      }
    }
  }
]

expected_app_screen: {
  activity: "com.example.android.snake/com.example.android.snake.Snake"
  view_hierarchy_path: [
  ]
}

max_duration_sec: 300  # 5 minutes.

extras_spec: [
  # All of these a returned when the snake direction changes
  # The desired direction of movement: 0=left, 1=up, 2=down, 3=right
  { name: "move" shape: [1], dtype: INT32 },
  # The direction of the snake: 1=north, 2=south, 3=east, 4=west
  { name: "direction" shape: [1], dtype: INT32 },
  # The grid cells: x=border,' '=empty,'s'=snake,'a'=apple
  { name: "grid" shape: [13, 20], dtype: STRING_U1 }
]
