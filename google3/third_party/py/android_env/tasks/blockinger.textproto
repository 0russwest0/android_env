# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "blockinger"
name: "Blockinger"
description: "A clone of tetris with on-screen controls."
package_name: "org.blockinger2.game"
full_activity_name: "org.blockinger2.game/org.blockinger2.game.activities.GameActivity"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: BUILT_INTERNALLY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/blockinger"
          label: "0.3"
          path: "2020.03.09-blockinger-debug.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "org.blockinger2.game"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  { adb_call: { force_stop: { package_name: "org.blockinger2.game" } } },
  { adb_call: { clear_cache: { package_name: "org.blockinger2.game" } } },
  {
    adb_call: {
      start_activity: {
        full_activity: "org.blockinger2.game/org.blockinger2.game.activities.MainActivity"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            "--es", '"RL_TASK_GAME_CONFIG"', '"{\\"startLevel\\":7}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "org.blockinger2.game/org.blockinger2.game.activities.GameActivity"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
      num_retries: 10
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "org.blockinger2.game/org.blockinger2.game.activities.MainActivity"
      }
    }
  }
]

expected_app_screen: {
  activity: "org.blockinger2.game/org.blockinger2.game.activities.GameActivity"
}

max_duration_sec: 10800  # 3 hours.

extras_spec: [
  # Whether the down button has been pressed.
  { name: "down_pressed" shape: [1], dtype: INT32 },
  # Whether the left button has been pressed.
  { name: "left_pressed" shape: [1], dtype: INT32 },
  # Whether the right button has been pressed.
  { name: "right_pressed" shape: [1], dtype: INT32 },

  # Whether the drop button has been pressed.
  { name: "drop_pressed" shape: [1], dtype: INT32 },
  # Whether the rotate button has been pressed.
  { name: "rotate_right_pressed" shape: [1], dtype: INT32 },

  # One-hot encoded state of the board
  { name: "current_board" shape: [18, 10], dtype: INT32 },
  { name: "current_line" shape: [1], dtype: INT32 },
  { name: "cleared_lines" shape: [1], dtype: INT32 },

  # Type of the current piece
  { name: "current_piece" shape: [1], dtype: INT32 },
  # Type of the next piece
  { name: "next_piece" shape: [1], dtype: INT32 }
]
