# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "catch_the_ball_default"
name: "Catch The Ball - Default"
description: "Catch the falling ball with the paddle."
package_name: "com.example.catchtheball"
full_activity_name: "com.example.catchtheball/com.example.catchtheball.MainActivity"

setup_steps: [
  {
    adb_call: {
      install_apk: {
      # copybara:strip_begin(MPM not necessary)
        apk_source: FIRST_PARTY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/catch_the_ball"
          label: "0.1"
          path: "2020.07.21-catch-the-ball-debug.apk"
        }
      # copybara:strip_end_and_replace_begin
      #  filesystem: {
      #    path: "./apks/catch_the_ball/2020.07.21-catch-the-ball-debug.apk"
      #  }
      # copybara:replace_end
      }
    }
    success_condition: {
      check_install: {
        package_name: "com.example.catchtheball"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  {
    adb_call: {
      start_activity: {
        full_activity: "com.example.catchtheball/com.example.catchtheball.MainActivity"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            "--es", '"RL_TASK_GAME_CONFIG"', '"{\\"lives\\":0}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "com.example.catchtheball/com.example.catchtheball.MainActivity"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
      num_retries: 10
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "com.example.catchtheball/com.example.catchtheball.MainActivity"
      }
    }
  }
]

expected_app_screen: {
  activity: "com.example.catchtheball/com.example.catchtheball.MainActivity"
  view_hierarchy_path: [
  ]
}

max_duration_sec: 60  # 1 minute.

extras_spec: [
  # All of these a returned when the ball arrives at the bottom of the screen
  # The number of remaining lives
  { name: "lives" shape: [1], dtype: INT32},
  # The x,y coordinates of the centel of the ball
  { name: "ball" shape: [2], dtype: INT32},
  # The x,y coordinates of the center of the paddle
  { name: "paddle" shape: [2], dtype: INT32},
  # The paddle width
  { name: "paddle_width" shape: [1], dtype: INT32}
]
