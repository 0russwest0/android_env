# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "mdp_flood_it_3"
name: "MDP Flood-It - 3 Balls"
description: "A 2-state 3-action MDP game for debugging agents."
package_name: "com.example.vokram"
full_activity_name: "com.example.vokram/com.example.vokram.MainActivity"
log_tag: "Vokram"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: FIRST_PARTY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/mdp"
          label: "1.8"
          path: "2020.08.06-vokram-debug.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "com.example.vokram"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  {
    adb_call: {
      start_activity: {
        full_activity: "com.example.vokram/com.example.vokram.MainActivity"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            "--es", '"RL_TASK_GAME_CONFIG"', '"{"'
            '"\\"initialSeed\\":-1,"' # Each episode will be randomized.
            '"\\"stickToGrid\\":true,"'
            '"\\"gridSize\\":6,"' # overide default = actions array size
            '"\\"actionResPrefix\\":\\"flood_it_ball_1\\","' # show action image instead of text
            '"\\"actionWidthDp\\":50,"' # button width in DP (Density-independent Pixels)
            '"\\"actionHeightDp\\":57,"' # button height in DP (Density-independent Pixels)
            '"\\"bgColors\\":\\"#F6F6F6\\","'
            '"\\"states\\":[0,1],"'
            '"\\"initial_states_prob\\":[{\\"S\\":\\"0\\",\\"P\\":1.0}],"'
            # '"\\"terminal_state\\":1,"' # Uncomment to terminate after 1 successful click
            # Ball colors: a=purple, b=blue, c=green, d=yellow, e=red, f=pink
            '"\\"actions\\":[\\"e\\", \\"a\\", \\"c\\"],"'
            '"\\"transitions\\":["'
            '"{\\"FS\\":\\"0\\",\\"A\\":\\"e\\",\\"TS\\":\\"1\\",\\"P\\":1.0,\\"R\\":1.0},"'
            '"{\\"FS\\":\\"0\\",\\"A\\":\\"a\\",\\"TS\\":\\"1\\",\\"P\\":1.0,\\"R\\":1.0},"'
            '"{\\"FS\\":\\"0\\",\\"A\\":\\"c\\",\\"TS\\":\\"1\\",\\"P\\":1.0,\\"R\\":1.0},"'
            '"{\\"FS\\":\\"1\\",\\"A\\":\\"e\\",\\"TS\\":\\"0\\",\\"P\\":1.0,\\"R\\":1.0},"'
            '"{\\"FS\\":\\"1\\",\\"A\\":\\"a\\",\\"TS\\":\\"0\\",\\"P\\":1.0,\\"R\\":1.0},"'
            '"{\\"FS\\":\\"1\\",\\"A\\":\\"c\\",\\"TS\\":\\"0\\",\\"P\\":1.0,\\"R\\":1.0}"'
            '"],"'
            '"\\"movementSpeed\\":[0,0,1]"' # Prevent action buttons from moving.
            '"}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "com.example.vokram/com.example.vokram.MainActivity"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "com.example.vokram/com.example.vokram.MainActivity"
      }
    }
  }
]

expected_app_screen: {
  activity: "com.example.vokram/com.example.vokram.MainActivity"
  view_hierarchy_path: [
  ]
}

max_duration_sec: 60  # 1 minute.

extras_spec: [
  # All of these a returned when any button is pressed
  # Set of all buttons e.g. ['A', 'B']
  { name: "actions" shape: [6], dtype: STRING_U1},
  # Label of the button just pressed e.g. ['B']
  { name: "clicks" shape: [1], dtype: STRING_U1 },
  # Coordinates of the top left and bottom right corners of each button
  # [x_a_0, y_a_0, x_a_1, y_a_1], [x_b_0, y_a_0, x_b_1, y_b_1]
  { name: "buttons" shape: [6, 4], dtype: INT32 }
]
