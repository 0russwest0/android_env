# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "perfection_1_square_static"
name: "Perfection - 1 Square - Static size & color"
description: "Put all the pieces in matching holes."
package_name: "com.example.perfection"
full_activity_name: "com.example.perfection/com.example.perfection.MainActivity"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: FIRST_PARTY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/perfection"
          label: "0.1"
          path: "2020.09.29-perfection-debug.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "com.example.perfection"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  {
    adb_call: {
      start_activity: {
        full_activity: "com.example.perfection/com.example.perfection.MainActivity"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            # - pieces: nb pieces (default: 1)
            # - size: % of screen (smallest width) (default: random between 10-20%)
            # - kind: 0=random, 1=square, 2=circle, 3=triangle, 4=plus (default: random between all)
            # - color: RRGGBB or #RRGGBB (default: random)
            "--es", '"RL_TASK_GAME_CONFIG"', '"{\\"pieces\\":1,\\"size\\":20,\\"kind\\":1,\\"color\\":\\"00ff00\\"}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "com.example.perfection/com.example.perfection.MainActivity"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "com.example.perfection/com.example.perfection.MainActivity"
      }
    }
  }
]

expected_app_screen: {
  activity: "com.example.perfection/com.example.perfection.MainActivity"
  view_hierarchy_path: [
  ]
}

max_duration_sec: 60  # 1 minute.

extras_spec: [
  # All of these a returned when value changes
  # The ID of the piece being dragged on the screen or 0
  { name: "moving" shape: [1], dtype: INT32},
  # The number of pieces not in a hole
  { name: "todo" shape: [1], dtype: INT32},
  # The number of pieces in a hole
  { name: "done" shape: [1], dtype: INT32}
]
