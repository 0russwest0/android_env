# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: androidenv.Task

id: "polytopia_default"
name: "Polytopia - Default Task"
description: "The Battle For Polytopia, by Midjiwan."
log_tag: "Unity"
log_prefix: "AndroidRLTask:"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: THIRD_PARTY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/polytopia"
          label: "2.0.31"
          path: "Polytopia-Android-2.0.31-RC2-Deepmind.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "com.midjiwan.polytopia.alpha"
        timeout_sec: 20.0
      }
    }
  },
  {
    adb_call: {
      start_intent: {
        action: "android.intent.action.VIEW"
        data_uri: "polytopia://newgame"
        package_name: "com.midjiwan.polytopia.alpha"
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "com.midjiwan.polytopia.alpha/com.unity3d.player.UnityPlayerActivity"
        }
        timeout_sec: 20.0
      }
      num_retries: 10
    }
  }
]

reset_steps: [
  {
    adb_call: {
      start_intent: {
        action: "android.intent.action.VIEW"
        data_uri: "polytopia://newgame?opponents=1\\&tribe=xin-xi\\&difficulty=easy\\&gamemode=domination"
        package_name: "com.midjiwan.polytopia.alpha"
      }
    }
    success_condition: {
      wait_for_message: {
        message: 'ready'
        timeout_sec: 60.0
      }
      num_retries: 3
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "com.midjiwan.polytopia.alpha/com.unity3d.player.UnityPlayerActivity"
      }
    }
  }
]

extras_spec: [
  { name: "turns" shape: [1], dtype: INT32 },
  { name: "currency" shape: [1], dtype: INT32 },
  { name: "income" shape: [1], dtype: INT32 }
# Unsupported extras (no shape, or >1 word)
  # { name: "city founded" shape: [0], dtype: INT32 }
  # { name: "city captured" shape: [0], dtype: INT32 }
  # { name: "city lost" shape: [0], dtype: INT32 }
  # { name: "won" shape: [0], dtype: INT32 }
  # { name: "lost" shape: [0], dtype: INT32 }
  # { name: "examine ruins" shape: [0], dtype: INT32 }
  # { name: "examine ruins" shape: [0], dtype: INT32 }
  # { name: "damage taken" shape: [1], dtype: INT32 }
  # #sic
  # { name: "damage deatl" shape: [1], dtype: INT32 }

]


max_duration_sec: 600  # 10 minutes.
