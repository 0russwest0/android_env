# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "pong_default"
name: "Pong - Default"
description: "A simplistic retro Pong game for Android."
package_name: "catalinc.games.pong"
full_activity_name: "catalinc.games.pong/catalinc.games.pong.Pong"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: BUILT_INTERNALLY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/pong"
          label: "0.1"
          path: "2020.10.16-pong-debug.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "catalinc.games.pong"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  { adb_call: { force_stop: { package_name: "catalinc.games.pong" } } },
  { adb_call: { clear_cache: { package_name: "catalinc.games.pong" } } },
  {
    adb_call: {
      start_activity: {
        full_activity: "catalinc.games.pong/catalinc.games.pong.Pong"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            # ball: radius in px (default=15)
            # computer: paddle width in px (default=85)
            # human: paddle width in px (default=85)
            "--es", '"RL_TASK_GAME_CONFIG"', '"{}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "catalinc.games.pong/catalinc.games.pong.Pong"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
      num_retries: 10
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "catalinc.games.pong/catalinc.games.pong.Pong"
      }
    }
  }
]

expected_app_screen: {
  activity: "catalinc.games.pong/catalinc.games.pong.Pong"
  view_hierarchy_path: [
  ]
}

max_duration_sec: 300  # 5 minutes.

extras_spec: [
  # All of these a returned when changed
  # The ball coordinates: left, top, right, bottom
  { name: "ball" shape: [4], dtype: INT32},
  # The computer paddle coordinates: left, top, right, bottom
  { name: "computer" shape: [4], dtype: INT32},
  # The human (agent) paddle coordinates: left, top, right, bottom
  { name: "human" shape: [4], dtype: INT32},
  # The collision between the human (agent) and the ball (0=no collision, 1-*=collision)
  { name: "collision" shape: [1], dtype: INT32},
  # The current state of the game (0=pause, 1=ready, 2=running, 3=lose, 4=win)
  { name: "state" shape: [1], dtype: INT32}
]
