# proto-file: google3/third_party/py/android_env/proto/task.proto
# proto-message: android_env.Task

id: "shakespell_4x4"
name: "Shakespell 4x4"
description: "Form words to get points. The longer the better."
package_name: "com.google.example.games.shakespell"
full_activity_name: "com.google.example.games.shakespell/com.google.example.games.shakespell.ui.ShakeSpellActivity"

setup_steps: [
  {
    adb_call: {
      install_apk: {
        apk_source: FIRST_PARTY
        mpm: {
          package_name: "learning/deepmind/research/xgames/android/apks/shakespell"
          label: "0.2"
          path: "2020.05.04-shakespell_debug_alldpi_x86-no_menu.apk"
        }
      }
    }
    success_condition: {
      check_install: {
        package_name: "com.google.example.games.shakespell"
        timeout_sec: 10.0
      }
    }
  },
  { adb_call: { rotate: { orientation: PORTRAIT_0 } } }
]

reset_steps: [
  { adb_call: { force_stop: { package_name: "com.google.example.games.shakespell" } } },
  { adb_call: { clear_cache: { package_name: "com.google.example.games.shakespell" } } },
  {
    adb_call: {
      grant_permissions: {
        package_name: "com.google.example.games.shakespell"
        permissions: "android.permission.ACCESS_COARSE_LOCATION"
      }
    }
  },
  {
    adb_call: {
      start_activity: {
        full_activity: "com.google.example.games.shakespell/.ui.ShakeSpellActivity"
        extra_args: [
            "--ez", '"RL_TASK_ENABLED"', '"true"',
            "--es", '"RL_TASK_GAME_CONFIG"', '"{"'
              '"\\"boardSize\\":\\"4x4\\","'
              '"\\"roundDurationMs\\":300000"' # 5 minutes
            '"}"'
        ]
      }
    }
    success_condition: {
      wait_for_app_screen: {
        app_screen: {
          activity: "com.google.example.games.shakespell/com.google.example.games.shakespell.ui.ShakeSpellActivity"
          view_hierarchy_path: [
          ]
        }
        timeout_sec: 10.0
      }
      num_retries: 10
    }
  },
  {
    adb_call: {
      start_screen_pinning: {
        full_activity: "com.google.example.games.shakespell/com.google.example.games.shakespell.ui.ShakeSpellActivity"
      }
    }
  }
]

expected_app_screen: {
  activity: "com.google.example.games.shakespell/com.google.example.games.shakespell.ui.ShakeSpellActivity"
  view_hierarchy_path: [
  ]
}

max_duration_sec: 300  # 5 minutes.

extras_spec: [
  # All of these a returned when the grid is changed
  # The submitted word (max length 4x4=16)
  { name: "submitted" shape: [1], dtype: STRING_U16 },
  # The valid word (max length 4x4=16)
  { name: "valid" shape: [1], dtype: STRING_U16 },
  # The invalid word (max length 4x4=16)
  { name: "invalid" shape: [1], dtype: STRING_U16 },
  # The repeated word (max length 4x4=16)
  { name: "repeated" shape: [1], dtype: STRING_U16 },
  # The board characters array (max length 4x4=16)
  { name: "board" shape: [4, 4], dtype: STRING_U16 },
  # The selected cells (1 if selected, 0 otherwise)
  { name: "selected" shape: [4, 4], dtype: INT32 },
  # Coordinates of the cell just clicked (between 1-4)
  { name: "click" shape: [2], dtype: INT32 },
  # List of currently selected characters (max length 4x4=16)
  { name: "current" shape: [1], dtype: STRING_U16 }
]
